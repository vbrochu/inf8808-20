{"version":3,"sources":["src/groups.js","src/viz3.js"],"names":["colors","groups","roles","d3","margin","top","right","bottom","left","svgSize","graphSize","setSizing","g","generateG","appendAxes","appendGraphLabels","positionLabels","width","height","data","roleGroups","roleColors","csv","then","groupOrder","getSortedGroups","preprocess","xScale","setXScale","yScale","setYScale","colorScale","setColorScale","sortedKeys","sortKeys","stackedData","stack","offset","stackOffsetSilhouette","keys","value","d","key","count","drawXAxis","drawYAxis","area","x","i","year","y0","y1","Tooltip","append","attr","style","mouseover","selectAll","filter","a","select","mousemove","text","mouseleave","enter","on","graphWidth","Math","min","self","innerWidth","graphHeight","setCanvasSize","normalize","emptyGroups","Object","forEach","thisYear","Date","getFullYear","yearLimit","element","roleId","parseInt","role","substr","find","row","push","yearSum","scaleLinear","domain","extent","range","rolesSum","groupsColors","entries","r","scaleOrdinal","call","axisBottom","tickSizeOuter","tickFormat","format","axisLeft","tickArguments","groupTotals","sort","b","map","e","order","indexa","findIndex","indexb"],"mappings":"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","file":"viz3.112b2779.js","sourceRoot":"..","sourcesContent":["/*\r\n#00876c\r\n#2c9470\r\n#45a074\r\n#5cad78\r\n#72b97c\r\n#88c580\r\n#9fd184\r\n#b6dd89\r\n#cee98f\r\n#e6f495\r\n#ffff9d\r\n#ffed8a\r\n#fedb79\r\n#fcc86b\r\n#fab560\r\n#f7a258\r\n#f38f52\r\n#ed7b4f\r\n#e7674e\r\n#de534f\r\n#d43d51\r\n*/\r\n\r\nexport const colors = {\r\n    'Acteur':'#8fda59',\r\n    'Production':'#42952e',\r\n    'Technique':'#b3b3b3',\r\n    'Esthetique':'#bfcd8e',\r\n    'Image':'#4cf32c',\r\n    'Son':'#eb46ea',\r\n    'Scénario':'#713d83',\r\n    'Organisme':'#8115b4',\r\n    'Narration':'#e9d737',\r\n    'Documentaire/émission':'#b3b3b3',\r\n    'Science':'#b3b3b3',\r\n    'Régie':'#b3b3b3',\r\n    'Réalisation':'#35618f',\r\n    'Direction artistique':'#9e7ee9',\r\n    'Direction de production':'#34debb',\r\n    'Photographe de plateau':'#da2d82',\r\n    'Générique additionnel':'#828282',\r\n    'Maison de services':'#b3b3b3',\r\n    'Conception':'#b3b3b3',\r\n    'Création':'#b3b3b3'\r\n}\r\n\r\nexport const groups = {\r\n    24: 'Acteur',\r\n    25: 'Acteur',\r\n    15: 'Acteur',\r\n\r\n    28: 'Production',\r\n    29: 'Production',\r\n    48: 'Production',\r\n\r\n    4: 'Technique',\r\n    5: 'Technique',\r\n\r\n    6: 'Esthetique',\r\n    8: 'Esthetique',\r\n    9: 'Esthetique',\r\n    17: 'Esthetique',\r\n\r\n    2: 'Image',\r\n    12: 'Image',\r\n    14: 'Image',\r\n    19: 'Image',\r\n\r\n    7: 'Son',\r\n    18: 'Son',\r\n    20: 'Son',\r\n    27: 'Son',\r\n    16: 'Son',\r\n    21: 'Son',\r\n\r\n    31: 'Scénario',\r\n    32: 'Scénario',\r\n    33: 'Scénario',\r\n\r\n    34: 'Organisme',\r\n    39: 'Organisme',\r\n    40: 'Organisme',\r\n    43: 'Organisme',\r\n    49: 'Organisme',\r\n    37: 'Organisme',\r\n\r\n    22: 'Narration',\r\n    23: 'Narration',\r\n\r\n    35: 'Documentaire/émission',\r\n    36: 'Documentaire/émission',\r\n    47: 'Documentaire/émission',\r\n\r\n    38: 'Science',\r\n    41: 'Science',\r\n\r\n    30: 'Régie',\r\n\r\n    3: 'Réalisation',\r\n    1: 'Réalisation',\r\n\r\n    10: 'Direction artistique',\r\n\r\n    11: 'Direction de production',\r\n\r\n    26: 'Photographe de plateau',\r\n\r\n    13: 'Générique additionnel',\r\n\r\n    42: 'Maison de services',\r\n\r\n    44: 'Conception',\r\n\r\n    45: 'Création'\r\n}\r\n\r\nexport const roles = {\r\n    1:\"Réalisation\",\r\n    15:\"Interprétation\",\r\n    34:\"Société de production\",\r\n    28:\"Producteur\",\r\n    14:\"Images\",\r\n    31:\"Scénario\",\r\n    37:\"Financement\",\r\n    24:\"Participant\",\r\n    19:\"Montage images\",\r\n    21:\"Musique\",\r\n    27:\"Prise de son\",\r\n    43:\"Télédiffuseur\",\r\n    13:\"Générique additionnel\",\r\n    2:\"Animation\",\r\n    29:\"Producteur délégué\",\r\n    38:\"Recherche\",\r\n    39:\"Société de distribution\",\r\n    10:\"Direction artistique\",\r\n    20:\"Montage sonore\",\r\n    23:\"Narrateur\",\r\n    35:\"Animateur d'émission\",\r\n    18:\"Mixage\",\r\n    25:\"Personnage\",\r\n    26:\"Photographe de plateau\",\r\n    16:\"Interprète musique\",\r\n    11:\"Direction de production\",\r\n    48:\"Producteur exécutif\",\r\n    8:\"Costumes\",\r\n    7:\"Conception sonore\",\r\n    32:\"Scripte\",\r\n    22:\"Narration\",\r\n    3:\"Assistant réalisation\",\r\n    17:\"Maquillage\",\r\n    9:\"Décors\",\r\n    36:\"Journaliste\",\r\n    44:\"Conception\",\r\n    47:\"Chroniqueur\",\r\n    6:\"Coiffure\",\r\n    12:\"Effets spéciaux\",\r\n    30:\"Régie\",\r\n    40:\"Société d'exportation\",\r\n    5:\"Chef machiniste\",\r\n    4:\"Chef électricien\",\r\n    45:\"Création\",\r\n    49:\"Diffuseur Web\",\r\n    42:\"Maison de services\",\r\n    41:\"Laboratoire\"\r\n}\r\n","'use strict'\r\n\r\nimport * as groups from './groups.js'\r\n\r\n/*\r\nBASE <http://data.cinematheque.qc.ca>\r\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\nPREFIX frbroo: <http://iflastandards.info/ns/fr/frbr/frbroo/>\r\nPREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\r\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\r\nPREFIX wdt: <http://www.wikidata.org/prop/direct/>\r\nPREFIX wd: <http://www.wikidata.org/entity/>\r\n\r\nSELECT ?role ?roleLabel ?year (count(?role) as ?count) WHERE {\r\n  ?publicProjectionEvent crm:P16_used_specific_object ?publicationExpression .\r\n  ?publicationExpression crm:P165_incorporates ?recording .\r\n  ?recordingEvent frbroo:R21_created ?recording .\r\n  ?recordingEvent crm:P9_consists_of ?recordingActivity .\r\n  ?recordingEvent frbroo:R22_created_a_realization_of ?recordingWork .\r\n  ?recordingWork frbroo:R2_is_derivative_of ?work .\r\n  ?work crm:P102_has_title ?workTitle .\r\n  FILTER (contains(str(?work), \"http://data.cinematheque.qc.ca\") && contains(str(?workTitle),\"OriginalTitleWork\"))\r\n  ?recordingActivityCarriedOutBy crm:P01_has_domain ?recordingActivity .\r\n  ?recordingActivityCarriedOutBy crm:P14.1_in_the_role_of ?role .\r\n  ?role rdfs:label ?roleLabel .\r\n  \r\n  ?publicProjectionEvent crm:P4_has_time-span ?timespan .\r\n  ?timespan crm:P82a_begin_of_the_begin ?releaseBegin .\r\n  ?timespan crm:P79_beginning_is_qualified_by ?releaseBegin .\r\n  ?timespan crm:P80_end_is_qualified_by ?releaseEnd .\r\n  \r\n  BIND(year(?releaseBegin) as ?year)\r\n  BIND(year(?releaseEnd) as ?year)\r\n}\r\nGROUP BY ?role ?roleLabel ?year\r\nORDER BY ?year ?roleLabel\r\n*/\r\n\r\n(function (d3) {\r\n  let margin = {\r\n    top: 75,\r\n    right: 200,\r\n    bottom: 100,\r\n    left: 80\r\n  }\r\n\r\n  let svgSize, graphSize\r\n\r\n  setSizing()\r\n\r\n  let g = generateG(margin)\r\n\r\n  appendAxes(g)\r\n  appendGraphLabels(g)\r\n\r\n  positionLabels(g, graphSize.width, graphSize.height)\r\n\r\n  let data = [];\r\n  let roleGroups = groups.groups;\r\n  let roleColors = groups.colors\r\n\r\n  d3.csv('./data3.csv').then((roles) => {\r\n    let groupOrder = getSortedGroups(roles, roleGroups);\r\n    data = preprocess(roles, roleGroups, true);\r\n    \r\n    let xScale = setXScale(graphSize.width, data);\r\n    let yScale = setYScale(graphSize.height, data, roleGroups);\r\n    let colorScale = setColorScale(roleGroups, roleColors);\r\n\r\n    let sortedKeys = sortKeys(roleGroups, groupOrder);\r\n\r\n    var stackedData = d3.stack()\r\n        .offset(d3.stackOffsetSilhouette)\r\n        .keys(sortedKeys)\r\n        .value((d,key) => d[key].count)\r\n        (data);\r\n\r\n    drawXAxis(xScale, graphSize.height)\r\n    drawYAxis(yScale)\r\n\r\n    let area = d3.area()\r\n    .x(function(d, i) { return xScale(d.data.year); })\r\n    .y0(function(d) { return yScale(d[0]); })\r\n    .y1(function(d) { return yScale(d[1]); });\r\n\r\n    var Tooltip = g\r\n        .append(\"text\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", 0)\r\n        .style(\"opacity\", 0)\r\n        .style(\"font-size\", 17)\r\n\r\n    var mouseover = function(d) {\r\n        Tooltip.style(\"opacity\", 1)\r\n        d3.selectAll(\"#viz3 .myArea\").style(\"opacity\", .2)\r\n            .style('stroke-width', '1px');\r\n        d3.selectAll(\"#viz3 .myArea\")\r\n            .filter(a => roleGroups[a.key] == roleGroups[d.key])\r\n            .style(\"stroke\", \"black\")\r\n            .style(\"opacity\", 0.6);\r\n        d3.select(this)\r\n            .style(\"stroke\", \"black\")\r\n            .style(\"opacity\", 1)\r\n            .style('stroke-width', '2px');\r\n    }\r\n    var mousemove = function(d,i) {\r\n        //console.log( d3.event )\r\n        let text = \"\";\r\n        if (roleGroups[d.key] != groups.roles[d.key]) {\r\n            text = roleGroups[d.key] + \":\" + groups.roles[d.key];\r\n        } else {\r\n            text = roleGroups[d.key];\r\n        }\r\n        \r\n        Tooltip.text(text)\r\n    }\r\n    var mouseleave = function(d) {\r\n        Tooltip.style(\"opacity\", 0)\r\n        d3.selectAll(\"#viz3 .myArea\").style(\"opacity\", 1).style(\"stroke\", \"none\")\r\n    }\r\n\r\n    g\r\n    .selectAll(\"mylayers\")\r\n    .data(stackedData)\r\n    .enter()\r\n    .append(\"path\")\r\n      .attr(\"class\", \"myArea\")\r\n      .style(\"fill\", function(d) { return colorScale(d.key); })\r\n      .attr(\"d\",area)\r\n      .on(\"mouseover\", mouseover)\r\n      .on(\"mousemove\", mousemove)\r\n      .on(\"mouseleave\", mouseleave);\r\n  })\r\n\r\n  \r\n  /**\r\n   *   This function handles the graph's sizing.\r\n   */\r\n   function setSizing () {\r\n    let graphWidth = Math.min(self.innerWidth, 2000);\r\n    let graphHeight = graphWidth * 0.6;\r\n\r\n    svgSize = {\r\n      width: graphWidth,\r\n      height: graphHeight\r\n    }\r\n\r\n    graphSize = {\r\n      width: svgSize.width - margin.right - margin.left,\r\n      height: svgSize.height - margin.bottom - margin.top\r\n    }\r\n\r\n    setCanvasSize(svgSize.width, svgSize.height)\r\n  }\r\n})(d3)\r\n\r\n  function preprocess(roles, groups, normalize=true) {\r\n      let data = []\r\n      let emptyGroups = {};\r\n      Object.keys(groups).forEach(key =>{\r\n          emptyGroups[key] = 0;\r\n      })\r\n\r\n      let thisYear = new Date().getFullYear();\r\n      let yearLimit = ((thisYear -5) - (thisYear -5) % 5) - 1;\r\n\r\n      roles.forEach(element => {\r\n          let roleId = parseInt(element.role.substr(44));\r\n          let year = element.year - element.year % 5;\r\n          if (year <= yearLimit) {\r\n            if (!data.find(d => d.year == year)){\r\n                let row = {'year':year};\r\n                Object.keys(groups).forEach(key =>{\r\n                  row[key] = 0;\r\n                })\r\n                data.push(row);\r\n            }\r\n  \r\n            data.find(d => d.year == year)[roleId] = parseInt(element.count);\r\n          }\r\n      });\r\n      if (normalize) {\r\n          data.forEach(d => {\r\n              let yearSum = 0;\r\n              Object.keys(groups).forEach(g => {\r\n                yearSum += d[g];\r\n              });\r\n              Object.keys(groups).forEach(g => {\r\n                d[g] = {'count':d[g], 'proportion':d[g]/yearSum};\r\n              });\r\n          })\r\n      }\r\n      return data;\r\n  }\r\n\r\n  function setXScale (width, data) {\r\n\treturn d3.scaleLinear()\r\n\t\t\t.domain(d3.extent(data, function(d) { return d.year; }))\r\n\t\t\t.range([0, width]);\r\n}\r\n\r\nfunction setYScale (height, data, roleGroups) {\r\n\t// TODO : Define the linear scale in y for the scatter plot\r\n\tlet range = 0;\r\n\r\n    data.forEach(d => {\r\n        let rolesSum = 0;\r\n        Object.keys(roleGroups).forEach(key => {\r\n            if (d[key].count){\r\n                rolesSum += d[key].count;\r\n            }\r\n        })\r\n        if (rolesSum > range){\r\n            range = rolesSum;\r\n        }\r\n    });\r\n\r\n\treturn d3.scaleLinear()\r\n        .domain([-1 * range / 2, range / 2])\r\n        .range([ height, 0 ]);\r\n}\r\n\r\nfunction setColorScale (roleGroups, groupsColors) {\r\n    let domain = [];\r\n    let colors = [];\r\n    Object.entries(roleGroups).forEach(r => {\r\n        domain.push(r[0]);\r\n        colors.push(groupsColors[r[1]]);\r\n    });\r\n    return d3.scaleOrdinal()\r\n        .domain(domain)\r\n        .range(colors);\r\n}\r\n\r\n/**\r\n * Draws the X axis at the bottom of the diagram.\r\n *\r\n * @param {*} xScale The scale to use to draw the axis\r\n * @param {number} height The height of the graphic\r\n */\r\nfunction drawXAxis (xScale, height) {\r\n    d3.select('#viz3 .x.axis')\r\n      .attr('transform', 'translate( 0, ' + height + ')')\r\n      .call(d3.axisBottom(xScale).tickSizeOuter(0).tickFormat(d3.format(\"d\")))//.tickArguments([5, '~s']))\r\n  }\r\n  \r\n  /**\r\n   * Draws the Y axis to the left of the diagram.\r\n   *\r\n   * @param {*} yScale The scale to use to draw the axis\r\n   */\r\nfunction drawYAxis (yScale) {\r\n    d3.select('#viz3 .y.axis')\r\n      .call(d3.axisLeft(yScale).tickSizeOuter(0).tickArguments([5, '.0r']))\r\n  }\r\n\r\nfunction getSortedGroups(data, groups){\r\n    let groupTotals = {};\r\n    data.forEach(d => {\r\n        let roleId = parseInt(d.role.substr(44));\r\n        if (!groupTotals[groups[roleId]]) {\r\n            groupTotals[groups[roleId]] = 0;\r\n        }\r\n        groupTotals[groups[roleId]] += parseInt(d.count);\r\n    })\r\n\r\n    return Object.entries(groupTotals).sort((a,b) => b[1] - a[1]).map(e => e[0]);    \r\n}\r\n\r\nfunction sortKeys(roles, order){\r\n    let sortedKeys = Object.entries(roles).sort((a,b) => {\r\n        let indexa = order.findIndex(r => r == a[1]);\r\n        let indexb = order.findIndex(r => r == b[1]);\r\n        if(indexa < indexb) { return -1; }\r\n        if(indexa > indexb) { return 1; }\r\n        return 0;\r\n    }).map(e => e[0]);\r\n    return sortedKeys;\r\n}\r\n\r\nfunction appendAxes (g) {\r\n    g.append('g')\r\n    .attr('class', 'x axis')\r\n}\r\n\r\nfunction appendGraphLabels (g) {\r\n    g.append('text')\r\n        .text('Année')\r\n        .attr('class', 'x axis-text')\r\n        .attr('font-size', 20)\r\n}\r\n\r\nfunction positionLabels (g, width, height) {\r\n    // TODO : Position axis labels\r\n      d3.select('#viz3 .y.axis-text')\r\n          .attr('x', -48)\r\n          .attr('y', height / 2)\r\n  \r\n      d3.select('#viz3 .x.axis-text')\r\n          .attr('x', width / 2)\r\n          .attr('y', height+40)\r\n  }\r\n\r\n function generateG (margin) {\r\n    return d3.select('.graph-viz3')\r\n      .select('svg')\r\n      .append('g')\r\n      .attr('id', 'graph-g')\r\n      .attr('transform',\r\n        'translate(' + margin.left + ',' + margin.top + ')')\r\n  }\r\n\r\n  function setCanvasSize (width, height) {\r\n    d3.select('#viz3')\r\n      .attr('width', width)\r\n      .attr('height', height)\r\n  }"]}